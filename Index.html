<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta charset="utf-8">

        <title>PokeCard Silhouette</title>
        <link rel="icon" href="icon.png">

        <link rel="stylesheet" href="layout.css">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.9/css/all.css" integrity="sha384-5SOiIsAziJl6AWe0HWRKTXlfcSHKmYV4RBF18PPJ173Kzn7jzMyFuTtk8JA7QQG1" crossorigin="anonymous">
    </head>

    <body>
    <img id="logo" src="pcsLogo.png">
    <div id = "main">
	    <div id="menu">
		    <div class="step" id="step1">
		    	<h4>Dimensions</h4>
		    	<div>
			    	Width <input id="cardsxPicker" type="number" value="5" min="1" max="5"> 
			    	Height <input id="cardsyPicker" type="number" value="4" min="1" max="5">
		    	</div>
		    	<div>
		    	    X Half card off set <input id="xHalfCard" type="checkbox"><br>
			    	Y Half card off set <input id="yHalfCard" type="checkbox">
		    	</div>
		    	<!--<div>
					Imperial <input type="radio" value="other"> 
					Metric <input type="radio" value="other">
		    	</div>-->
		    </div>	   
		    <div class="step" id="step3"><h4>Background card</h4>

		    	<img id="currentCardBarckground" class="sideCard" src="graycardpack.png">	   
		    </div>
		    <div class="step" id="step3"><h4>Cards</h4>
		    	<img data-row="0" data-col="0" class="mainCard sideCard" src="graycardpack.png">
		    	<img data-row="0" data-col="1" class="mainCard sideCard" src="graycardpack.png">
		    	<img data-row="0" data-col="2" class="mainCard sideCard" src="graycardpack.png">
		    	<img data-row="0" data-col="3" class="mainCard sideCard" src="graycardpack.png">
		    	<img data-row="0" data-col="4" class="mainCard sideCard" src="graycardpack.png">
		    	<br>
		    	<img data-row="1" data-col="0" class="mainCard sideCard" src="graycardpack.png">
		    	<img data-row="1" data-col="1" class="mainCard sideCard" src="graycardpack.png">
		    	<img data-row="1" data-col="2" class="mainCard sideCard" src="graycardpack.png">
		    	<img data-row="1" data-col="3" class="mainCard sideCard" src="graycardpack.png">
		    	<img data-row="1" data-col="4" class="mainCard sideCard" src="graycardpack.png">
		    	<br>
		    	<img data-row="2" data-col="0" class="mainCard sideCard" src="graycardpack.png">
		    	<img data-row="2" data-col="1" class="mainCard sideCard" src="graycardpack.png">
		    	<img data-row="2" data-col="2" class="mainCard sideCard" src="graycardpack.png">
		    	<img data-row="2" data-col="3" class="mainCard sideCard" src="graycardpack.png">
		    	<img data-row="2" data-col="4" class="mainCard sideCard" src="graycardpack.png">
		    	<br>
		    	<img data-row="3" data-col="0" class="mainCard sideCard" src="graycardpack.png">
		    	<img data-row="3" data-col="1" class="mainCard sideCard" src="graycardpack.png">
		    	<img data-row="3" data-col="2" class="mainCard sideCard" src="graycardpack.png">
		    	<img data-row="3" data-col="3" class="mainCard sideCard" src="graycardpack.png">
		    	<img data-row="3" data-col="4" class="mainCard sideCard" src="graycardpack.png">
		    	<br>	    	
		    	<img data-row="4" data-col="0" class="mainCard sideCard" src="graycardpack.png">
		    	<img data-row="4" data-col="1" class="mainCard sideCard" src="graycardpack.png">
		    	<img data-row="4" data-col="2" class="mainCard sideCard" src="graycardpack.png">
		    	<img data-row="4" data-col="3" class="mainCard sideCard" src="graycardpack.png">
		    	<img data-row="4" data-col="4" class="mainCard sideCard" src="graycardpack.png">
		    	<br>	    		    	
		    </div>
		    <div class="step" id="step3"><h4>Silhouette</h4>
		    	<div class="buttonedTextBox">Url: <div><input id="SilhouetteUrlTextBox" type="Text"><i id="setSilhouetteButton" class="fas fa-angle-double-right"></i></div></div>
		    	<img id="currentSilhouette" src="">
		    	Show <input id="showSilhouette" type="checkbox" checked>
		    	<br><img class="previewImage" id="silhouettePreview">
		    </div>
		    <div class="step" id="step2"><h4>Foreground</h4>	    	
		    	<div class="buttonedTextBox">Url: <div><input id="bgUrlTextBox" type="Text"><i id="setBgButton" class="fas fa-angle-double-right"></i></div></div>
		    	<img id="currentForeground" src="">
		    	Show <input id="showForeground" type="checkbox" checked>
		    	<br><img class="previewImage" id="foregroundPreview">
		    </div>	    
	    </div>
	    <canvas id="silhouetteCanvas" width="800" height="800" style="border:1px solid #d3d3d3;">
	    Your browser does not support the HTML5 canvas tag.
	    </canvas>
	</div>

    <div id="findCardForm">
    	<div id="searchCardInput">
    		<div class="buttonedTextBox">Name: <div><input id="cardName" type="Text" value="mew"><i id="findButton" class="fas fa-search"></i></div></div>
    		<i id="findCardClose" class="fas fa-times-circle"></i></div>
    	<div id="findCards"></div>
    </div>


    <script type="text/javascript" src="PokeSilhouette.js"></script>   
    <script>

    	function DoDraw()
    	{
			let c = document.getElementById("silhouetteCanvas");
            let ctx = c.getContext("2d");
            ctx.clearRect(0,0,c.width,c.height);
            ctx.drawImage(PokeSilhouette.DoDraw(), 0 , 0);
    	}

    	function DisplayFindForm(show)
    	{
    		document.getElementById("findCardForm").style.display = (show ? "block" : "none");
    	}

		function set1Card(sender)
		{
			let row = sender.dataset.row;
			let col = sender.dataset.col;
			PokeSilhouette.SelectionCallBack = function(cardData) {
				console.log(cardData);
				DisplayFindForm(false);
				PokeSilhouette.cardArray[row][col] = cardData.image;
				sender.src = cardData.image.src;
				DoDraw();
			}
			DisplayFindForm(true);
		}

		function SetArray(card)
		{
        	let cardsx = document.getElementById("cardsxPicker").value;
            let cardsy = document.getElementById("cardsyPicker").value;

			let carray = [];
	    	for(let y = 0; y < cardsy; y++)
	        {
	        	let row = [];

	            for(let x = 0; x < cardsx; x++)
					row.push(card);
	            
	            carray.push(row);
	        }

	        PokeSilhouette.cardArray = carray;
		}

    	document.getElementById("xHalfCard").onchange = function(){DoDraw()};
    	document.getElementById("yHalfCard").onchange = function(){DoDraw()};
    	document.getElementById("showForeground").onchange = function(){DoDraw()};
		document.getElementById("showSilhouette").onchange = function(){DoDraw()};
		document.getElementById("findButton").onclick = function(){PokeSilhouette.FindCards(document.getElementById("cardName").value)};
		document.getElementById("findCardClose").onclick = function(){DisplayFindForm(false);};

		document.getElementById("currentCardBarckground").onclick = function()
		{
			PokeSilhouette.SelectionCallBack = function(cardData) {				
				DisplayFindForm(false);
				SetArray(cardData.image);

				document.getElementById("currentCardBarckground").src = cardData.image.src;
				DoDraw();
			}
			DisplayFindForm(true);
		}

		let classname = document.getElementsByClassName("mainCard");
		for (let i = 0; i < classname.length; i++) 
		{
		    classname[i].onclick = function(){set1Card(this);};
		}

		document.getElementById("setBgButton").onclick = function()
		{
			let newBg = new Image;
			newBg.src = document.getElementById("bgUrlTextBox").value;
			newBg.onload = function(){				
				document.getElementById("foregroundPreview").src = newBg.src;			
				PokeSilhouette.backgroundData.image = newBg;
				DoDraw();
			};
		};

		document.getElementById("setSilhouetteButton").onclick = function()
		{
			let newSilhouette = new Image;
			newSilhouette.src = document.getElementById("SilhouetteUrlTextBox").value;
			newSilhouette.onload = function(){
				document.getElementById("silhouettePreview").src = newSilhouette.src;
				PokeSilhouette.maskData.image = newSilhouette;
				DoDraw();
			};
		};

        window.onload = function() 
        {
            let bg = new Image;
            bg.src = "https://motionarray.imgix.net/preview-72760-rLNwCGtel0_0014.jpg";
            bg.onload = function(){

            	PokeSilhouette.backgroundData.image = bg;

	            let mask = new Image; 
	            //mask.crossOrigin="anonymous"	            
	            mask.src = "https://i.imgur.com/r2LyYV6.png";

	            mask.onload = function(){

	            	PokeSilhouette.maskData.image = mask;

	                let card = new Image; 
	                card.crossOrigin="anonymous"
	                card.src = "https://images.pokemontcg.io/xy12/101.png";
	                card.onload = function(){

	                	SetArray(card);
	                	DoDraw();
	                };
	            };
	        };
        };

    </script> 
    </body>
</html>
